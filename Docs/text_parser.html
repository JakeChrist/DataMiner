<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>text_parser</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><details><summary>app</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="__main__.html">__main__</a></li><li><a href="config.html">config</a></li><li><a href="logging.html">logging</a></li><li><details><summary>ingest</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="preview.html">preview</a></li><li><a href="service.html">service</a></li><li><details><summary>parsers</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="docx_parser.html">docx_parser</a></li><li><a href="markdown_parser.html">markdown_parser</a></li><li><a href="pdf_parser.html">pdf_parser</a></li><li><a href="text_parser.html">text_parser</a></li></ul></details></li></ul></details></li><li><details><summary>retrieval</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="index.html">index</a></li><li><a href="search.html">search</a></li></ul></details></li><li><details><summary>services</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="backup_service.html">backup_service</a></li><li><a href="conversation_manager.html">conversation_manager</a></li><li><a href="conversation_settings.html">conversation_settings</a></li><li><a href="document_hierarchy.html">document_hierarchy</a></li><li><a href="export_service.html">export_service</a></li><li><a href="lmstudio_client.html">lmstudio_client</a></li><li><a href="progress_service.html">progress_service</a></li><li><a href="project_service.html">project_service</a></li><li><a href="settings_service.html">settings_service</a></li></ul></details></li><li><details><summary>storage</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="database.html">database</a></li></ul></details></li><li><details><summary>ui</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="answer_view.html">answer_view</a></li><li><a href="evidence_panel.html">evidence_panel</a></li><li><a href="main_window.html">main_window</a></li><li><a href="question_input_widget.html">question_input_widget</a></li></ul></details></li></ul></details></li><li><details><summary>tests</summary><ul><li><a href="test_dynamic_planning.html">test_dynamic_planning</a></li><li><a href="test_export_and_backup.html">test_export_and_backup</a></li><li><a href="test_ingest_service.html">test_ingest_service</a></li><li><a href="test_lmstudio_integration.html">test_lmstudio_integration</a></li><li><a href="test_parser_file_types.html">test_parser_file_types</a></li><li><a href="test_preview_service.html">test_preview_service</a></li><li><a href="test_project_service.html">test_project_service</a></li><li><a href="test_retrieval_index.html">test_retrieval_index</a></li><li><a href="test_search_service.html">test_search_service</a></li><li><a href="test_storage.html">test_storage</a></li><li><a href="test_ui_main_window.html">test_ui_main_window</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>text_parser</h1>
        <p>Module implements a plain text parser that reads files in binary mode and attempts to decode them using UTF-8 encoding. If UTF-8 decoding fails, it uses the chardet library to detect the encoding. If chardet is not available, it falls back to replacing invalid characters with a replacement character. The parser returns a ParsedDocument object containing the decoded text, detected encoding in metadata, a single document section, and a single page with the full text content.</p>
<h2>Functions</h2>
<h3 id="parse_text">parse_text(path: Path) -&gt; ParsedDocument</h3>
<p>The function `parse_text` reads a plain-text file from a given path and attempts to detect its encoding. It first tries to decode the file using UTF-8. If that fails with a `UnicodeDecodeError`, it uses the `chardet` library to detect the encoding, falling back to UTF-8 with replacement characters if detection fails or is unavailable. The function returns a `ParsedDocument` object containing the decoded text, detected encoding in metadata, a single section, and a single page.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">parse_text</span>(path: Path) <span style="color: #666666">-&gt;</span> ParsedDocument:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Parse a plain-text file while attempting to detect encoding.&quot;&quot;&quot;</span>

    raw <span style="color: #666666">=</span> path<span style="color: #666666">.</span>read_bytes()
    encoding <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;utf-8&quot;</span>
    <span style="color: #008000; font-weight: bold">try</span>:
        text <span style="color: #666666">=</span> raw<span style="color: #666666">.</span>decode(encoding)
    <span style="color: #008000; font-weight: bold">except</span> <span style="color: #CB3F38; font-weight: bold">UnicodeDecodeError</span>:
        <span style="color: #008000; font-weight: bold">try</span>:
            <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">chardet</span>  <span style="color: #3D7B7B; font-style: italic"># type: ignore[import-untyped]</span>
        <span style="color: #008000; font-weight: bold">except</span> <span style="color: #CB3F38; font-weight: bold">ImportError</span>:  <span style="color: #3D7B7B; font-style: italic"># pragma: no cover - defensive</span>
            text <span style="color: #666666">=</span> raw<span style="color: #666666">.</span>decode(encoding, errors<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replace&quot;</span>)
        <span style="color: #008000; font-weight: bold">else</span>:
            detected <span style="color: #666666">=</span> chardet<span style="color: #666666">.</span>detect(raw)
            encoding <span style="color: #666666">=</span> detected<span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;encoding&quot;</span>) <span style="color: #AA22FF; font-weight: bold">or</span> <span style="color: #BA2121">&quot;utf-8&quot;</span>
            text <span style="color: #666666">=</span> raw<span style="color: #666666">.</span>decode(encoding, errors<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replace&quot;</span>)

    metadata <span style="color: #666666">=</span> {<span style="color: #BA2121">&quot;encoding&quot;</span>: encoding}
    sections <span style="color: #666666">=</span> [DocumentSection(title<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>, content<span style="color: #666666">=</span>text)]
    pages <span style="color: #666666">=</span> [PageContent(number<span style="color: #666666">=1</span>, text<span style="color: #666666">=</span>text)]
    <span style="color: #008000; font-weight: bold">return</span> ParsedDocument(text<span style="color: #666666">=</span>text, metadata<span style="color: #666666">=</span>metadata, sections<span style="color: #666666">=</span>sections, pages<span style="color: #666666">=</span>pages)
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
