<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test_project_service</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><details><summary>app</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="__main__.html">__main__</a></li><li><a href="config.html">config</a></li><li><a href="logging.html">logging</a></li><li><details><summary>ingest</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="preview.html">preview</a></li><li><a href="service.html">service</a></li><li><details><summary>parsers</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="docx_parser.html">docx_parser</a></li><li><a href="markdown_parser.html">markdown_parser</a></li><li><a href="pdf_parser.html">pdf_parser</a></li><li><a href="text_parser.html">text_parser</a></li></ul></details></li></ul></details></li><li><details><summary>retrieval</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="index.html">index</a></li><li><a href="search.html">search</a></li></ul></details></li><li><details><summary>services</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="backup_service.html">backup_service</a></li><li><a href="conversation_manager.html">conversation_manager</a></li><li><a href="conversation_settings.html">conversation_settings</a></li><li><a href="document_hierarchy.html">document_hierarchy</a></li><li><a href="export_service.html">export_service</a></li><li><a href="lmstudio_client.html">lmstudio_client</a></li><li><a href="progress_service.html">progress_service</a></li><li><a href="project_service.html">project_service</a></li><li><a href="settings_service.html">settings_service</a></li></ul></details></li><li><details><summary>storage</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="database.html">database</a></li></ul></details></li><li><details><summary>ui</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="answer_view.html">answer_view</a></li><li><a href="evidence_panel.html">evidence_panel</a></li><li><a href="main_window.html">main_window</a></li><li><a href="question_input_widget.html">question_input_widget</a></li></ul></details></li></ul></details></li><li><details><summary>tests</summary><ul><li><a href="test_dynamic_planning.html">test_dynamic_planning</a></li><li><a href="test_export_and_backup.html">test_export_and_backup</a></li><li><a href="test_ingest_service.html">test_ingest_service</a></li><li><a href="test_lmstudio_integration.html">test_lmstudio_integration</a></li><li><a href="test_parser_file_types.html">test_parser_file_types</a></li><li><a href="test_preview_service.html">test_preview_service</a></li><li><a href="test_project_service.html">test_project_service</a></li><li><a href="test_retrieval_index.html">test_retrieval_index</a></li><li><a href="test_search_service.html">test_search_service</a></li><li><a href="test_storage.html">test_storage</a></li><li><a href="test_ui_main_window.html">test_ui_main_window</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>test_project_service</h1>
        <p>Defines a test case for managing corpus roots within a project service. The test uses an in-memory configuration manager and verifies operations such as adding, listing, removing, and clearing corpus roots. It also checks the creation and existence of storage paths and database snapshots associated with the project. The test ensures no duplicate entries are added and that proper cleanup occurs.</p>
<h2 id="InMemoryConfig">Class: InMemoryConfig</h2>
<p>The `InMemoryConfig` class provides a simple configuration manager implementation that stores configuration data in memory as a dictionary. It supports loading configuration data by returning a deep copy of the stored data, and saving configuration data by replacing the internal storage with a deep copy of the provided data. This implementation is designed for testing purposes and does not persist data beyond the lifetime of the object.</p>
<h3 id="__init__">Method: __init__(self) -&gt; None</h3>
<p>Initializes an instance of `InMemoryConfig` with an empty dictionary to store configuration data.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data: <span style="color: #008000">dict</span>[<span style="color: #008000">str</span>, <span style="color: #008000">object</span>] <span style="color: #666666">=</span> {}
</code></pre>
<h3 id="load">Method: load(self) -&gt; dict[str, object]</h3>
<p>The `load` method in the `InMemoryConfig` class returns a dictionary representation of the configuration data. It creates a deep copy of `self._data` by first serializing it to JSON and then deserializing it back to a Python object, ensuring that the returned dictionary is independent of the internal data structure.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">load</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">dict</span>[<span style="color: #008000">str</span>, <span style="color: #008000">object</span>]:
        <span style="color: #008000; font-weight: bold">return</span> json<span style="color: #666666">.</span>loads(json<span style="color: #666666">.</span>dumps(<span style="color: #008000">self</span><span style="color: #666666">.</span>_data))
</code></pre>
<h3 id="save">Method: save(self, data: dict[str, object]) -&gt; None</h3>
<p>The `save` method in the `InMemoryConfig` class updates the instance&#x27;s configuration data by replacing the existing `_data` attribute with a deep copy of the provided `data` dictionary. The method serializes the input dictionary to JSON and then deserializes it back into a Python object, ensuring that the internal representation is independent of the original data structure. This approach prevents external modifications to the passed-in dictionary from affecting the configuration state.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">save</span>(<span style="color: #008000">self</span>, data: <span style="color: #008000">dict</span>[<span style="color: #008000">str</span>, <span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_data <span style="color: #666666">=</span> json<span style="color: #666666">.</span>loads(json<span style="color: #666666">.</span>dumps(data))
</code></pre>
<h2>Functions</h2>
<h3 id="test_corpus_root_management">test_corpus_root_management(tmp_path: Path) -&gt; None</h3>
<p>The function `test_corpus_root_management` tests the management of corpus roots within a project, verifying operations such as adding, listing, removing, and clearing corpus roots. It ensures that duplicate roots are not added, and that the project storage path is correctly resolved and exists. The test also confirms that attempting to retrieve project storage for a project without roots raises a `RuntimeError`, and that exporting a database snapshot returns `None` when no roots are present. The function uses an in-memory configuration and a `ProjectService` instance to perform these operations, asserting expected behaviors and paths throughout the process. Finally, it ensures proper cleanup by shutting down the service.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_corpus_root_management</span>(tmp_path: Path) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    storage_root <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;storage&quot;</span>
    config <span style="color: #666666">=</span> InMemoryConfig()
    service <span style="color: #666666">=</span> ProjectService(storage_root<span style="color: #666666">=</span>storage_root, config_manager<span style="color: #666666">=</span>config)
    <span style="color: #008000; font-weight: bold">try</span>:
        project <span style="color: #666666">=</span> service<span style="color: #666666">.</span>active_project()
        <span style="color: #008000; font-weight: bold">assert</span> service<span style="color: #666666">.</span>list_corpus_roots(project<span style="color: #666666">.</span>id) <span style="color: #666666">==</span> []

        <span style="color: #008000; font-weight: bold">with</span> pytest<span style="color: #666666">.</span>raises(<span style="color: #CB3F38; font-weight: bold">RuntimeError</span>):
            service<span style="color: #666666">.</span>get_project_storage(project<span style="color: #666666">.</span>id)

        <span style="color: #008000; font-weight: bold">assert</span> service<span style="color: #666666">.</span>export_project_database_snapshot(project<span style="color: #666666">.</span>id) <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>

        first <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;docs&quot;</span>
        first<span style="color: #666666">.</span>mkdir()
        service<span style="color: #666666">.</span>add_corpus_root(project<span style="color: #666666">.</span>id, first)
        <span style="color: #008000; font-weight: bold">assert</span> service<span style="color: #666666">.</span>list_corpus_roots(project<span style="color: #666666">.</span>id) <span style="color: #666666">==</span> [<span style="color: #008000">str</span>(first<span style="color: #666666">.</span>resolve())]

        storage_path <span style="color: #666666">=</span> service<span style="color: #666666">.</span>get_project_storage(project<span style="color: #666666">.</span>id)
        <span style="color: #008000; font-weight: bold">assert</span> storage_path<span style="color: #666666">.</span>exists()
        <span style="color: #008000; font-weight: bold">assert</span> storage_path<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>name <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;projects&quot;</span>
        <span style="color: #008000; font-weight: bold">assert</span> storage_path<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>name <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;.dataminer&quot;</span>
        <span style="color: #008000; font-weight: bold">assert</span> storage_path<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>parent <span style="color: #666666">==</span> first<span style="color: #666666">.</span>resolve()
        snapshot_path <span style="color: #666666">=</span> storage_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;dataminer.db&quot;</span>
        <span style="color: #008000; font-weight: bold">assert</span> snapshot_path<span style="color: #666666">.</span>exists()

        <span style="color: #3D7B7B; font-style: italic"># Adding the same folder again should not create duplicates.</span>
        service<span style="color: #666666">.</span>add_corpus_root(project<span style="color: #666666">.</span>id, first)
        <span style="color: #008000; font-weight: bold">assert</span> service<span style="color: #666666">.</span>list_corpus_roots(project<span style="color: #666666">.</span>id) <span style="color: #666666">==</span> [<span style="color: #008000">str</span>(first<span style="color: #666666">.</span>resolve())]

        second <span style="color: #666666">=</span> tmp_path <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;more&quot;</span>
        second<span style="color: #666666">.</span>mkdir()
        service<span style="color: #666666">.</span>add_corpus_root(project<span style="color: #666666">.</span>id, second)
        roots <span style="color: #666666">=</span> service<span style="color: #666666">.</span>list_corpus_roots(project<span style="color: #666666">.</span>id)
        <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">set</span>(roots) <span style="color: #666666">==</span> {<span style="color: #008000">str</span>(first<span style="color: #666666">.</span>resolve()), <span style="color: #008000">str</span>(second<span style="color: #666666">.</span>resolve())}

        service<span style="color: #666666">.</span>remove_corpus_root(project<span style="color: #666666">.</span>id, first)
        <span style="color: #008000; font-weight: bold">assert</span> service<span style="color: #666666">.</span>list_corpus_roots(project<span style="color: #666666">.</span>id) <span style="color: #666666">==</span> [<span style="color: #008000">str</span>(second<span style="color: #666666">.</span>resolve())]

        service<span style="color: #666666">.</span>clear_corpus_roots(project<span style="color: #666666">.</span>id)
        <span style="color: #008000; font-weight: bold">assert</span> service<span style="color: #666666">.</span>list_corpus_roots(project<span style="color: #666666">.</span>id) <span style="color: #666666">==</span> []
    <span style="color: #008000; font-weight: bold">finally</span>:
        service<span style="color: #666666">.</span>shutdown()
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
