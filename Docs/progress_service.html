<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>progress_service</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><details><summary>app</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="__main__.html">__main__</a></li><li><a href="config.html">config</a></li><li><a href="logging.html">logging</a></li><li><details><summary>ingest</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="preview.html">preview</a></li><li><a href="service.html">service</a></li><li><details><summary>parsers</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="docx_parser.html">docx_parser</a></li><li><a href="markdown_parser.html">markdown_parser</a></li><li><a href="pdf_parser.html">pdf_parser</a></li><li><a href="text_parser.html">text_parser</a></li></ul></details></li></ul></details></li><li><details><summary>retrieval</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="index.html">index</a></li><li><a href="search.html">search</a></li></ul></details></li><li><details><summary>services</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="backup_service.html">backup_service</a></li><li><a href="conversation_manager.html">conversation_manager</a></li><li><a href="conversation_settings.html">conversation_settings</a></li><li><a href="document_hierarchy.html">document_hierarchy</a></li><li><a href="export_service.html">export_service</a></li><li><a href="lmstudio_client.html">lmstudio_client</a></li><li><a href="progress_service.html">progress_service</a></li><li><a href="project_service.html">project_service</a></li><li><a href="settings_service.html">settings_service</a></li></ul></details></li><li><details><summary>storage</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="database.html">database</a></li></ul></details></li><li><details><summary>ui</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="answer_view.html">answer_view</a></li><li><a href="evidence_panel.html">evidence_panel</a></li><li><a href="main_window.html">main_window</a></li><li><a href="question_input_widget.html">question_input_widget</a></li></ul></details></li></ul></details></li><li><details><summary>tests</summary><ul><li><a href="test_dynamic_planning.html">test_dynamic_planning</a></li><li><a href="test_export_and_backup.html">test_export_and_backup</a></li><li><a href="test_ingest_service.html">test_ingest_service</a></li><li><a href="test_lmstudio_integration.html">test_lmstudio_integration</a></li><li><a href="test_parser_file_types.html">test_parser_file_types</a></li><li><a href="test_preview_service.html">test_preview_service</a></li><li><a href="test_project_service.html">test_project_service</a></li><li><a href="test_retrieval_index.html">test_retrieval_index</a></li><li><a href="test_search_service.html">test_search_service</a></li><li><a href="test_storage.html">test_storage</a></li><li><a href="test_ui_main_window.html">test_ui_main_window</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>progress_service</h1>
        <p>Defines a progress tracking and toast notification system using PyQt6 signals. Provides a `ProgressUpdate` data class to represent progress state and a `ProgressService` class that manages subscriptions to progress events and emits signals for task start, update, and completion. Includes methods to subscribe and unsubscribe callbacks, dispatch updates, and integrate with background task emitters. Supports toast notifications with message, level, and duration parameters.</p>
<h2 id="ProgressUpdate">Class: ProgressUpdate</h2>
<p>The `ProgressUpdate` class defines a data object that encapsulates information about a progress update, including a task identifier, status message, completion percentage, and a flag indicating whether the progress is indeterminate. The class uses type hints to specify that `task_id` and `message` are strings, `percent` is a float or None, and `indeterminate` is a boolean with a default value of False. This structure provides a standardized way to represent progress state information within a system.</p>
<h2 id="ProgressService">Class: ProgressService</h2>
<p>The `ProgressService` class manages and broadcasts progress updates from background tasks to subscribed listeners using Qt signals. It provides methods to start, update, and finish progress events, as well as request toast notifications. The class supports integrating with background task emitters by connecting their signals to its own progress handling mechanisms.</p>
<h3 id="__init__">Method: __init__(self) -&gt; None</h3>
<p>Initializes the `ProgressService` instance, setting up an empty list to store subscriptions for progress updates. The class inherits from an unspecified parent class, and the `_subscriptions` attribute holds a list of callable objects that accept a `ProgressUpdate` parameter.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">super</span>()<span style="color: #666666">.</span><span style="color: #0000FF">__init__</span>()
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_subscriptions: <span style="color: #008000">list</span>[Callable[[ProgressUpdate], <span style="color: #008000; font-weight: bold">None</span>]] <span style="color: #666666">=</span> []
</code></pre>
<h3 id="subscribe">Method: subscribe(self, callback: Callable[[ProgressUpdate], None]) -&gt; None</h3>
<p>The `subscribe` method allows registering a callback function to receive raw progress events. It appends the provided callback to an internal list of subscriptions, ensuring that duplicate subscriptions are not added. The method takes a callable that accepts a `ProgressUpdate` parameter and returns `None`.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">subscribe</span>(<span style="color: #008000">self</span>, callback: Callable[[ProgressUpdate], <span style="color: #008000; font-weight: bold">None</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Subscribe ``callback`` to raw progress events.&quot;&quot;&quot;</span>

        <span style="color: #008000; font-weight: bold">if</span> callback <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_subscriptions:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>_subscriptions<span style="color: #666666">.</span>append(callback)
</code></pre>
<h3 id="unsubscribe">Method: unsubscribe(self, callback: Callable[[ProgressUpdate], None]) -&gt; None</h3>
<p>The function `unsubscribe` removes a specified callback function from the list of subscriptions managed by the `ProgressService` class. It takes a single argument, `callback`, which is expected to be a callable that accepts a `ProgressUpdate` object. The function checks if the callback exists in the internal `_subscriptions` list and removes it if present. This allows for dynamic management of event listeners or observers that are notified of progress updates.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsubscribe</span>(<span style="color: #008000">self</span>, callback: Callable[[ProgressUpdate], <span style="color: #008000; font-weight: bold">None</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Remove ``callback`` from the subscription list.&quot;&quot;&quot;</span>

        <span style="color: #008000; font-weight: bold">if</span> callback <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_subscriptions:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>_subscriptions<span style="color: #666666">.</span>remove(callback)
</code></pre>
<h3 id="_dispatch">Method: _dispatch(self, update: ProgressUpdate) -&gt; None</h3>
<p>The function `_dispatch` sends a `ProgressUpdate` object to all subscribed callbacks. It iterates over a copy of the `_subscriptions` list and invokes each callback with the provided update. This enables asynchronous notification of progress changes to multiple listeners.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_dispatch</span>(<span style="color: #008000">self</span>, update: ProgressUpdate) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">for</span> callback <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">list</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>_subscriptions):
            callback(update)
</code></pre>
<h3 id="start">Method: start(self, task_id: str, message: str=&#x27;&#x27;) -&gt; None</h3>
<p>The `start` method initializes a progress update event for a given task ID and optional message. It creates a `ProgressUpdate` object with the specified task ID, message, and an initial progress percentage of 0.0. The method then emits a `progress_started` signal with the created update object and dispatches the update using the `_dispatch` method. This function is used to notify listeners of a new progress tracking event and initiate the progress reporting cycle.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">start</span>(<span style="color: #008000">self</span>, task_id: <span style="color: #008000">str</span>, message: <span style="color: #008000">str</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        update <span style="color: #666666">=</span> ProgressUpdate(task_id<span style="color: #666666">=</span>task_id, message<span style="color: #666666">=</span>message, percent<span style="color: #666666">=0.0</span>)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>progress_started<span style="color: #666666">.</span>emit(update)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_dispatch(update)
</code></pre>
<h3 id="update">Method: update(self, task_id: str, *, message: str | None=None, percent: float | None=None, indeterminate: bool | None=None) -&gt; None</h3>
<p>The `update` method in the `ProgressService` class emits a `ProgressUpdate` event with specified progress details, including a task ID, message, percentage, and indeterminate state. It constructs a `ProgressUpdate` object using the provided parameters and forwards it to registered listeners via the `progress_updated` signal. Additionally, it dispatches the update internally using the `_dispatch` method. The method accepts optional parameters for the progress message, completion percentage, and indeterminate state, defaulting values where necessary.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">update</span>(
        <span style="color: #008000">self</span>,
        task_id: <span style="color: #008000">str</span>,
        <span style="color: #666666">*</span>,
        message: <span style="color: #008000">str</span> <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
        percent: <span style="color: #008000">float</span> <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
        indeterminate: <span style="color: #008000">bool</span> <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
    ) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        update <span style="color: #666666">=</span> ProgressUpdate(
            task_id<span style="color: #666666">=</span>task_id,
            message<span style="color: #666666">=</span>message <span style="color: #AA22FF; font-weight: bold">or</span> <span style="color: #BA2121">&quot;&quot;</span>,
            percent<span style="color: #666666">=</span>percent,
            indeterminate<span style="color: #666666">=</span><span style="color: #008000">bool</span>(indeterminate) <span style="color: #008000; font-weight: bold">if</span> indeterminate <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">False</span>,
        )
        <span style="color: #008000">self</span><span style="color: #666666">.</span>progress_updated<span style="color: #666666">.</span>emit(update)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_dispatch(update)
</code></pre>
<h3 id="finish">Method: finish(self, task_id: str, message: str=&#x27;&#x27;) -&gt; None</h3>
<p>The `finish` method marks a progress task as completed by creating a `ProgressUpdate` object with a specified task ID, optional message, and sets the completion percentage to 100.0. It then emits a `progress_finished` signal with the update and dispatches the update internally.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">finish</span>(<span style="color: #008000">self</span>, task_id: <span style="color: #008000">str</span>, message: <span style="color: #008000">str</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        update <span style="color: #666666">=</span> ProgressUpdate(task_id<span style="color: #666666">=</span>task_id, message<span style="color: #666666">=</span>message, percent<span style="color: #666666">=100.0</span>)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>progress_finished<span style="color: #666666">.</span>emit(update)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_dispatch(update)
</code></pre>
<h3 id="notify">Method: notify(self, message: str, *, level: str=&#x27;info&#x27;, duration_ms: int=4000) -&gt; None</h3>
<p>The function `notify` emits a signal requesting a toast notification with a specified message, level, and duration. It takes a message string, an optional level (defaulting to &quot;info&quot;), and an optional duration in milliseconds (defaulting to 4000). The signal `toast_requested` is emitted with these parameters to trigger the display of the notification.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">notify</span>(<span style="color: #008000">self</span>, message: <span style="color: #008000">str</span>, <span style="color: #666666">*</span>, level: <span style="color: #008000">str</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;info&quot;</span>, duration_ms: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">4000</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Request a toast notification.&quot;&quot;&quot;</span>

        <span style="color: #008000">self</span><span style="color: #666666">.</span>toast_requested<span style="color: #666666">.</span>emit(message, level, duration_ms)
</code></pre>
<h3 id="subscribe_to">Method: subscribe_to(self, emitter: QObject) -&gt; None</h3>
<p>The `subscribe_to` method connects a background task emitter to the `ProgressService` by linking its `started`, `progress`, and `finished` signals to corresponding methods in the service. It handles three types of signals: `started` triggers the `start` method, `progress` triggers the `update` method, and `finished` triggers the `finish` method. The method checks for the existence of each signal before connecting it.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">subscribe_to</span>(<span style="color: #008000">self</span>, emitter: QObject) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Connect a background task emitter with ``started/progress/finished`` signals.&quot;&quot;&quot;</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">hasattr</span>(emitter, <span style="color: #BA2121">&quot;started&quot;</span>):
            emitter<span style="color: #666666">.</span>started<span style="color: #666666">.</span>connect(<span style="color: #008000; font-weight: bold">lambda</span> task_id, message<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>: <span style="color: #008000">self</span><span style="color: #666666">.</span>start(task_id, message))  <span style="color: #3D7B7B; font-style: italic"># type: ignore[arg-type]</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">hasattr</span>(emitter, <span style="color: #BA2121">&quot;progress&quot;</span>):
            emitter<span style="color: #666666">.</span>progress<span style="color: #666666">.</span>connect(  <span style="color: #3D7B7B; font-style: italic"># type: ignore[attr-defined]</span>
                <span style="color: #008000; font-weight: bold">lambda</span> task_id, percent, message<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>: <span style="color: #008000">self</span><span style="color: #666666">.</span>update(
                    task_id, message<span style="color: #666666">=</span>message, percent<span style="color: #666666">=</span>percent
                )
            )
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">hasattr</span>(emitter, <span style="color: #BA2121">&quot;finished&quot;</span>):
            emitter<span style="color: #666666">.</span>finished<span style="color: #666666">.</span>connect(<span style="color: #008000; font-weight: bold">lambda</span> task_id, message<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>: <span style="color: #008000">self</span><span style="color: #666666">.</span>finish(task_id, message))
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
