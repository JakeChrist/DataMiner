<!-- Generated by DocGen-LM -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>config</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <button id="sidebar-toggle">Menu</button>
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul><li><a href="index.html"><strong>üè† Project Overview</strong></a></li><li><details><summary>app</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="__main__.html">__main__</a></li><li><a href="config.html">config</a></li><li><a href="logging.html">logging</a></li><li><details><summary>ingest</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="preview.html">preview</a></li><li><a href="service.html">service</a></li><li><details><summary>parsers</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="docx_parser.html">docx_parser</a></li><li><a href="markdown_parser.html">markdown_parser</a></li><li><a href="pdf_parser.html">pdf_parser</a></li><li><a href="text_parser.html">text_parser</a></li></ul></details></li></ul></details></li><li><details><summary>retrieval</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="index.html">index</a></li><li><a href="search.html">search</a></li></ul></details></li><li><details><summary>services</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="backup_service.html">backup_service</a></li><li><a href="conversation_manager.html">conversation_manager</a></li><li><a href="conversation_settings.html">conversation_settings</a></li><li><a href="document_hierarchy.html">document_hierarchy</a></li><li><a href="export_service.html">export_service</a></li><li><a href="lmstudio_client.html">lmstudio_client</a></li><li><a href="progress_service.html">progress_service</a></li><li><a href="project_service.html">project_service</a></li><li><a href="settings_service.html">settings_service</a></li></ul></details></li><li><details><summary>storage</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="database.html">database</a></li></ul></details></li><li><details><summary>ui</summary><ul><li><a href="__init__.html">__init__</a></li><li><a href="answer_view.html">answer_view</a></li><li><a href="evidence_panel.html">evidence_panel</a></li><li><a href="main_window.html">main_window</a></li><li><a href="question_input_widget.html">question_input_widget</a></li></ul></details></li></ul></details></li><li><details><summary>tests</summary><ul><li><a href="test_dynamic_planning.html">test_dynamic_planning</a></li><li><a href="test_export_and_backup.html">test_export_and_backup</a></li><li><a href="test_ingest_service.html">test_ingest_service</a></li><li><a href="test_lmstudio_integration.html">test_lmstudio_integration</a></li><li><a href="test_parser_file_types.html">test_parser_file_types</a></li><li><a href="test_preview_service.html">test_preview_service</a></li><li><a href="test_project_service.html">test_project_service</a></li><li><a href="test_retrieval_index.html">test_retrieval_index</a></li><li><a href="test_search_service.html">test_search_service</a></li><li><a href="test_storage.html">test_storage</a></li><li><a href="test_ui_main_window.html">test_ui_main_window</a></li></ul></details></li></ul>
    </div>
    <div class="content">
        <h1>config</h1>
        <p>The module provides functionality for managing application configuration settings stored in either JSON or INI format. It defines a `ConfigManager` class to load, save, and update configuration data, along with a helper function `get_user_config_dir` that determines the appropriate directory for storing configuration files based on the operating system. The configuration directory is created if it does not exist. The `ConfigManager` supports specifying the format and filename for the configuration file, defaulting to JSON with a standard filename if none is provided. It handles reading and writing configuration data in the specified format, ensuring proper structure for INI files with sections and key-value pairs. The module also includes validation for format specification and update operations.</p>
<h2 id="ConfigManager">Class: ConfigManager</h2>
<p>The `ConfigManager` class manages loading and saving user configuration settings in either JSON or INI format. It initializes with an application name, configuration format, and file name, determining the appropriate file path using a user configuration directory. The class provides methods to load configuration into a dictionary, save a dictionary to disk, and update the stored configuration with new data, handling both JSON and INI formats appropriately.</p>
<h3 id="__init__">Method: __init__(self, app_name: str=CONFIG_DIR_NAME, *, format: str=&#x27;json&#x27;, filename: str | None=None) -&gt; None</h3>
<p>Initializes a `ConfigManager` instance with specified application name, configuration format, and filename. Sets the configuration directory and path based on the provided parameters, ensuring the format is either &#x27;json&#x27; or &#x27;ini&#x27;. Raises a `ValueError` if an invalid format is specified. Uses default filenames for JSON and INI formats if no filename is provided.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(
        <span style="color: #008000">self</span>,
        app_name: <span style="color: #008000">str</span> <span style="color: #666666">=</span> CONFIG_DIR_NAME,
        <span style="color: #666666">*</span>,
        <span style="color: #008000">format</span>: <span style="color: #008000">str</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;json&quot;</span>,
        filename: <span style="color: #008000">str</span> <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
    ) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>app_name <span style="color: #666666">=</span> app_name
        <span style="color: #008000">self</span><span style="color: #666666">.</span>format <span style="color: #666666">=</span> <span style="color: #008000">format</span><span style="color: #666666">.</span>lower()
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>format <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> {<span style="color: #BA2121">&quot;json&quot;</span>, <span style="color: #BA2121">&quot;ini&quot;</span>}:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>(<span style="color: #BA2121">&quot;format must be either &#39;json&#39; or &#39;ini&#39;&quot;</span>)
        <span style="color: #008000; font-weight: bold">if</span> filename <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>:
            filename <span style="color: #666666">=</span> (
                DEFAULT_JSON_FILENAME <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>format <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;json&quot;</span> <span style="color: #008000; font-weight: bold">else</span> DEFAULT_INI_FILENAME
            )
        <span style="color: #008000">self</span><span style="color: #666666">.</span>config_dir <span style="color: #666666">=</span> get_user_config_dir(app_name)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>config_path <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>config_dir <span style="color: #666666">/</span> filename
</code></pre>
<h3 id="load">Method: load(self) -&gt; dict[str, Any]</h3>
<p>The `load` method reads configuration data from a specified file path and returns it as a dictionary. If the configuration file does not exist, it returns an empty dictionary. The method supports loading configuration in either JSON or INI format, depending on the value of `self.format`. For JSON files, it uses `json.load()` to parse the file. For INI files, it uses `configparser.ConfigParser` to read sections and their key-value pairs, returning a nested dictionary where each top-level key corresponds to a section in the INI file.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">load</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">dict</span>[<span style="color: #008000">str</span>, Any]:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Load configuration from disk.</span>

<span style="color: #BA2121; font-style: italic">        Returns an empty dictionary if the configuration file is absent.</span>
<span style="color: #BA2121; font-style: italic">        &quot;&quot;&quot;</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>config_path<span style="color: #666666">.</span>exists():
            <span style="color: #008000; font-weight: bold">return</span> {}

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>format <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;json&quot;</span>:
            <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>config_path<span style="color: #666666">.</span>open(<span style="color: #BA2121">&quot;r&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>) <span style="color: #008000; font-weight: bold">as</span> fh:
                <span style="color: #008000; font-weight: bold">return</span> json<span style="color: #666666">.</span>load(fh)

        parser <span style="color: #666666">=</span> ConfigParser()
        parser<span style="color: #666666">.</span>read(<span style="color: #008000">self</span><span style="color: #666666">.</span>config_path, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>)
        <span style="color: #008000; font-weight: bold">return</span> {section: <span style="color: #008000">dict</span>(parser<span style="color: #666666">.</span>items(section)) <span style="color: #008000; font-weight: bold">for</span> section <span style="color: #AA22FF; font-weight: bold">in</span> parser<span style="color: #666666">.</span>sections()}
</code></pre>
<h3 id="save">Method: save(self, data: MutableMapping[str, Any]) -&gt; None</h3>
<p>The `save` method persists configuration data to disk in either JSON or INI format, depending on the `format` attribute of the `ConfigManager` instance. For JSON format, it writes the data to a file with indentation and sorted keys. For INI format, it uses `configparser.ConfigParser` to structure the data into sections and writes it to the file. The method raises a `ValueError` if INI format is used with non-mapping values per section.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">save</span>(<span style="color: #008000">self</span>, data: MutableMapping[<span style="color: #008000">str</span>, Any]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Persist configuration data to disk.&quot;&quot;&quot;</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>format <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;json&quot;</span>:
            <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>config_path<span style="color: #666666">.</span>open(<span style="color: #BA2121">&quot;w&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>) <span style="color: #008000; font-weight: bold">as</span> fh:
                json<span style="color: #666666">.</span>dump(data, fh, indent<span style="color: #666666">=2</span>, sort_keys<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
                fh<span style="color: #666666">.</span>write(<span style="color: #BA2121">&quot;</span><span style="color: #AA5D1F; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>)
            <span style="color: #008000; font-weight: bold">return</span>

        parser <span style="color: #666666">=</span> ConfigParser()
        <span style="color: #008000; font-weight: bold">for</span> section, values <span style="color: #AA22FF; font-weight: bold">in</span> data<span style="color: #666666">.</span>items():
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">isinstance</span>(values, MutableMapping):
                <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>(<span style="color: #BA2121">&quot;INI configuration requires mapping values per section&quot;</span>)
            parser[section] <span style="color: #666666">=</span> {<span style="color: #008000">str</span>(key): <span style="color: #008000">str</span>(value) <span style="color: #008000; font-weight: bold">for</span> key, value <span style="color: #AA22FF; font-weight: bold">in</span> values<span style="color: #666666">.</span>items()}
        <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>config_path<span style="color: #666666">.</span>open(<span style="color: #BA2121">&quot;w&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BA2121">&quot;utf-8&quot;</span>) <span style="color: #008000; font-weight: bold">as</span> fh:
            parser<span style="color: #666666">.</span>write(fh)
</code></pre>
<h3 id="update">Method: update(self, data: MutableMapping[str, Any]) -&gt; dict[str, Any]</h3>
<p>The `update` method in the `ConfigManager` class updates the stored configuration with provided data and returns the updated configuration. It first loads the current configuration, then applies the updates based on the configuration format (JSON or INI). For JSON, it directly updates the loaded dictionary with the provided data. For INI format, it ensures that each section in the provided data is a mapping and that the existing section in the configuration is also a mapping before updating. After applying the updates, it saves the modified configuration and returns the updated version.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">update</span>(<span style="color: #008000">self</span>, data: MutableMapping[<span style="color: #008000">str</span>, Any]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">dict</span>[<span style="color: #008000">str</span>, Any]:
<span style="color: #bbbbbb">        </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Update the stored configuration with ``data`` and return the result.&quot;&quot;&quot;</span>
        current <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>load()
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>format <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;json&quot;</span>:
            current<span style="color: #666666">.</span>update(data)
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">for</span> section, values <span style="color: #AA22FF; font-weight: bold">in</span> data<span style="color: #666666">.</span>items():
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">isinstance</span>(values, MutableMapping):
                    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>(
                        <span style="color: #BA2121">&quot;INI configuration updates require mapping values per section&quot;</span>
                    )
                section_data <span style="color: #666666">=</span> current<span style="color: #666666">.</span>setdefault(section, {})
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">isinstance</span>(section_data, <span style="color: #008000">dict</span>):
                    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>(
                        <span style="color: #BA2121">&quot;Existing INI section must be a mapping to apply updates&quot;</span>
                    )
                section_data<span style="color: #666666">.</span>update(values)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>save(current)
        <span style="color: #008000; font-weight: bold">return</span> current
</code></pre>
<h3 id="__repr__">Method: __repr__(self) -&gt; str</h3>
<p>The `__repr__` method of the `ConfigManager` class provides a string representation of the object for debugging purposes. It returns a formatted string that includes the application name, configuration format, and the path to the configuration file. The method is marked as a debugging helper and is excluded from coverage analysis.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__repr__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:  <span style="color: #3D7B7B; font-style: italic"># pragma: no cover - debugging helper</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">f&quot;ConfigManager(app_name=</span><span style="color: #A45A77; font-weight: bold">{</span><span style="color: #008000">self</span><span style="color: #666666">.</span>app_name<span style="color: #A45A77; font-weight: bold">!r}</span><span style="color: #BA2121">, format=</span><span style="color: #A45A77; font-weight: bold">{</span><span style="color: #008000">self</span><span style="color: #666666">.</span>format<span style="color: #A45A77; font-weight: bold">!r}</span><span style="color: #BA2121">, path=</span><span style="color: #A45A77; font-weight: bold">{</span><span style="color: #008000">self</span><span style="color: #666666">.</span>config_path<span style="color: #A45A77; font-weight: bold">!s}</span><span style="color: #BA2121">)&quot;</span>
</code></pre>
<h2>Functions</h2>
<h3 id="get_user_config_dir">get_user_config_dir(app_name: str=CONFIG_DIR_NAME) -&gt; Path</h3>
<p>The function `get_user_config_dir` returns the path to a configuration directory for the current user, creating it if it does not exist. On Windows, the directory is located under the `%APPDATA%` environment variable, while on other platforms it uses the XDG base directory specification or defaults to `~/.config`. The function accepts an optional `app_name` parameter to specify the name of the configuration directory, defaulting to `CONFIG_DIR_NAME`. The directory is created with all necessary parent directories using `mkdir(parents=True, exist_ok=True)`.</p>
<pre><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_user_config_dir</span>(app_name: <span style="color: #008000">str</span> <span style="color: #666666">=</span> CONFIG_DIR_NAME) <span style="color: #666666">-&gt;</span> Path:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return the configuration directory for the current user.</span>

<span style="color: #BA2121; font-style: italic">    The directory is created on first use. On Windows the directory is</span>
<span style="color: #BA2121; font-style: italic">    under ``%APPDATA%``; otherwise the XDG base directory or ``~/.config``</span>
<span style="color: #BA2121; font-style: italic">    is used.</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">if</span> sys<span style="color: #666666">.</span>platform<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">&quot;win&quot;</span>):
        base_dir <span style="color: #666666">=</span> Path(os<span style="color: #666666">.</span>getenv(<span style="color: #BA2121">&quot;APPDATA&quot;</span>, Path<span style="color: #666666">.</span>home()))
    <span style="color: #008000; font-weight: bold">else</span>:
        base_dir <span style="color: #666666">=</span> Path(os<span style="color: #666666">.</span>getenv(<span style="color: #BA2121">&quot;XDG_CONFIG_HOME&quot;</span>, Path<span style="color: #666666">.</span>home() <span style="color: #666666">/</span> <span style="color: #BA2121">&quot;.config&quot;</span>))
    config_dir <span style="color: #666666">=</span> base_dir <span style="color: #666666">/</span> app_name
    config_dir<span style="color: #666666">.</span>mkdir(parents<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>, exist_ok<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
    <span style="color: #008000; font-weight: bold">return</span> config_dir
</code></pre>
    </div>
    <script src="static/toggle.js"></script>
</body>
</html>
